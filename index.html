<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Direct Segment Visualization</title>
    
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; margin: 0; padding: 0; background-color: #f4f4f9; }
        header { background-color: #2c3e50; color: white; padding: 15px 20px; display: flex; justify-content: space-between; align-items: center; }
        h1 { margin: 0; font-size: 1.5rem; }
        .controls { background: white; padding: 15px; border-bottom: 1px solid #ddd; display: flex; align-items: center; gap: 10px; }
        select { padding: 8px; font-size: 1rem; border-radius: 4px; border: 1px solid #ccc; min-width: 300px; }
        .container { display: flex; height: calc(100vh - 130px); }
        #map { flex: 2; height: 100%; z-index: 1; background: #aad3df; /* ë°”ë‹¤ìƒ‰ ë°°ê²½ ì¶”ê°€ */ }
        .info-panel { flex: 1; padding: 20px; background: white; overflow-y: auto; border-left: 1px solid #ddd; min-width: 300px; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { border: 1px solid #ddd; padding: 10px; text-align: center; font-size: 0.9rem; }
        th { background-color: #34495e; color: white; }
        tr:nth-child(even) { background-color: #f9f9f9; }
        .summary-card { background: #ecf0f1; padding: 15px; border-radius: 8px; margin-bottom: 20px; }
        .summary-title { font-weight: bold; color: #7f8c8d; font-size: 0.9rem; }
        .summary-value { font-size: 1.5rem; color: #2c3e50; font-weight: bold; margin-top: 5px; }
        #loading { padding: 20px; text-align: center; color: #666; }
    </style>
</head>
<body>

<header>
    <h1>âœˆï¸ Flight Direct Segment Dashboard</h1>
</header>

<div class="controls">
    <label for="routeSelect"><strong>ë…¸ì„  ì„ íƒ:</strong></label>
    <select id="routeSelect">
        <option value="" disabled selected>ë…¸ì„ ì„ ì„ íƒí•´ì£¼ì„¸ìš”</option>
    </select>
</div>

<div class="container">
    <div id="map"></div>
    
    <div class="info-panel">
        <div id="dashboard-content" style="display:none;">
            <h2>ğŸ“Š êµ¬ê°„ ìƒì„¸ ì •ë³´</h2>
            
            <div class="summary-card">
                <div class="summary-title">ì´ í‰ê·  ì—°ë£Œ ì ˆê° (Total Avg Fuel Saving)</div>
                <div class="summary-value" id="totalFuel">0 kg</div>
            </div>
            
            <div class="summary-card">
                <div class="summary-title">ì´ í‰ê·  ì‹œê°„ ë‹¨ì¶• (Total Avg Time Saving)</div>
                <div class="summary-value" id="totalTime">0 min</div>
            </div>

            <h3>Segment List</h3>
            <table>
                <thead>
                    <tr>
                        <th>Start WPT</th>
                        <th>End WPT</th>
                        <th>Fuel (kg)</th>
                        <th>Time (min)</th>
                    </tr>
                </thead>
                <tbody id="segmentTableBody">
                </tbody>
            </table>
        </div>
        <div id="loading">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì´ê±°ë‚˜ ë…¸ì„ ì´ ì„ íƒë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.</div>
    </div>
</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
    // 1. ì§€ë„ ì´ˆê¸°í™” (íƒœí‰ì–‘ ì¤‘ì‹¬ ì¢Œí‘œë¡œ ë³€ê²½)
    // [35, 170]: ìœ„ë„ 35ë„, ê²½ë„ 170ë„ (íƒœí‰ì–‘ í•œê°€ìš´ë°)
    // worldCopyJump: ì§€ë„ë¥¼ ê³„ì† ë“œë˜ê·¸í•  ë•Œ ë§ˆì»¤ê°€ ë”°ë¼ì˜¤ë„ë¡ ì„¤ì •
    const map = L.map('map', {
        worldCopyJump: true
    }).setView([35, 170], 3);

    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: '&copy; OpenStreetMap contributors'
    }).addTo(map);

    let flightData = [];
    let currentLayers = L.layerGroup().addTo(map);

    fetch('flight_data.json')
        .then(response => response.json())
        .then(data => {
            flightData = data;
            initDropdown();
        })
        .catch(error => {
            console.error('Error loading JSON:', error);
            document.getElementById('loading').innerText = "ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨. flight_data.json íŒŒì¼ì„ í™•ì¸í•˜ì„¸ìš”.";
        });

    function initDropdown() {
        const select = document.getElementById('routeSelect');
        flightData.forEach(route => {
            const option = document.createElement('option');
            option.value = route.route_id;
            option.text = route.route_name;
            select.appendChild(option);
        });

        select.addEventListener('change', (e) => {
            updateDashboard(e.target.value);
        });
    }

    function updateDashboard(routeId) {
        currentLayers.clearLayers();
        const selectedRoute = flightData.find(r => r.route_id === routeId);
        if (!selectedRoute) return;

        document.getElementById('loading').style.display = 'none';
        document.getElementById('dashboard-content').style.display = 'block';

        const tableBody = document.getElementById('segmentTableBody');
        tableBody.innerHTML = '';
        let totalFuel = 0;
        let totalTime = 0;
        let bounds = [];

        selectedRoute.segments.forEach(seg => {
            totalFuel += seg.fuel_saving;
            totalTime += seg.time_saving;

            const polyline = L.polyline(seg.coords, {
                color: 'blue',
                weight: 4,
                opacity: 0.7,
                dashArray: '10, 10'
            }).addTo(currentLayers);

            const startMarker = L.circleMarker(seg.coords[0], { radius: 5, color: 'green' }).addTo(currentLayers);
            const endMarker = L.circleMarker(seg.coords[1], { radius: 5, color: 'red' }).addTo(currentLayers);

            const popupContent = `
                <b>${seg.start_wpt} â¡ï¸ ${seg.end_wpt}</b><br>
                Fuel Saving: ${seg.fuel_saving}kg<br>
                Time Saving: ${seg.time_saving}min
            `;
            polyline.bindPopup(popupContent);
            
            // ì§€ë„ ì¤Œì„ ë§ì¶”ê¸° ìœ„í•´ ì¢Œí‘œ ìˆ˜ì§‘
            bounds.push(seg.coords[0]);
            bounds.push(seg.coords[1]);

            const row = `
                <tr>
                    <td>${seg.start_wpt}</td>
                    <td>${seg.end_wpt}</td>
                    <td>${seg.fuel_saving}</td>
                    <td>${seg.time_saving}</td>
                </tr>
            `;
            tableBody.innerHTML += row;
        });

        document.getElementById('totalFuel').innerText = `${totalFuel} kg`;
        document.getElementById('totalTime').innerText = `${totalTime} min`;

        if (bounds.length > 0) {
            // fitBoundsë¥¼ í•  ë•Œ maxZoomì„ ì œí•œí•˜ì—¬ ë„ˆë¬´ í™•ëŒ€ë˜ì§€ ì•Šê²Œ í•¨
            map.fitBounds(bounds, { padding: [50, 50], maxZoom: 6 });
        }
    }
</script>

</body>
</html>